Theory

The following is a team project and we aim at physical implementation of the following model (Non-linear) in future. The following content deals with building a PID based control system for a Remotely operated underwater vehicle(ROV). The main challenge in implementing this is because the bot will be prone to many non-linearities underwater. 

So, the basic mathematical model of an ROV is given by:

![830cef13b07bfbf4c5cb1a011b4da28f.png](../_resources/ba15e74a6af343f78d3d633cdd888975.png)



where:
- M = Mass matrix (with added mass effect taken into account)
- C = Coriolis force matrix
- D = Damping forces matrix
- g = Restoring forces matrix
- ğœ = Forces & moments matrix

1) **Added Mass Effect:**
The added mass of an object is the effect in which some mass of fluid surrounding the object under observation is accelerated/decelerated along with it.

2) **Coriolis Effect:**
The Coriolis force is a fictitious force that comes into play whenever we are trying to explain the forces on an object with respect to a rotating frame.

3) **Ziegler-Nichols Method for tuning PIDs:**
This method can be used to tune our PID both in the case where we have a working model for our plant or even when we donâ€™t. The first step to this method is measuring two parameters: KU which is the gain at which the system becomes marginally stable and TU which is the period of oscillation at marginal system response. These values are found by taking KI and KD values to be zero for that input and changing KP until marginal stability is achieved.
After these parameters are evaluated controller gains can simply be calculated from the below table:


![6d62357c0240e75662ff3c0e1fe7be3e.png](../_resources/52332960fe1046339d5f8f5fa5dcfd67.png)


4) **Controller Models:**
The two controller models that we used are:
A. **Linear Model:**
The schematic of the simulink model created using the linear PID control looks like this:


![f87f6cad7e649802c0ad33f7bbcf190f.png](../_resources/6ff38e16faee4b3dabe86701eb915493.png)


It consists of different functionalities in each block of the design:


![b7b5681e74e71c8aef708ccb31f29ef5.png](../_resources/1025dd921c8f4e64863e1b927f7b474d.png)


The PID controller uses an error signal, called the tracking error, generated from the difference between the desired position and the current position of the rover. 


![77e51ca49fc29e00e835b61a44edc983.png](../_resources/3a66c0082e9f4b27853c2c211540bb84.png)


This error signal, in the world frame, is converted to the error signal in body frame ğ‘’b using the following equation:


![417cc79906edd0b83ea42a11b62be8fd.png](../_resources/47fe8a2f89884e2688f4279da646f101.png)


where the transformation matrix from the vehicle body frame to the world reference frame using Euler angle transformation is given by:  


![a93d9718ed2b18066a20ae419527faf7.png](../_resources/4737c01842e74f708bd2d13e29929148.png)


![6f40861dfc2f8731564b2e8047f8d90d.png](../_resources/9ff4a74c26b246158e5495abc744f02f.png)


Using the error signal in the body frame ğ‘’b, the torque generated by the PID can be calculated using the equation:


![eed4b8c10aefd5cb9b9f951ffd46d73f.png](../_resources/655ee50fa1974dfb9e902e8b38cf34a6.png)


In order to generalize the required control forces, control allocation calculates the control input signal u to apply to the thrusters. The control forces due to the control inputs applied to the thrusters can be expressed as:


![51c6bc2730ae57e3c1287fbeb9f62ab1.png](../_resources/26f0b443d372489690759e7502530396.png)


As a result, the control input vector can be derived as:


![07231a3d70e4419415f34b7024ddd8a5.png](../_resources/f731096bac0046c19e275ab9afa10212.png)


For the linear model, the following values of KP, KI, and KD have been obtained using the Ziegler-Nichols method:


![0b0304625973d6a5c95adcd9811e5754.png](../_resources/5de4671bcbf44efaa0f44a2f18744f4c.png)


![09aa1fa8ee8b9bdfdb03a88e75db286a.png](../_resources/c49e442eb3ea4c768ed4afc2afdff37f.png)


Using the control input vector, the thruster system generates the control forces in 6 DoFs with the help of the above mentioned equation:


![b7f9684fc715142cb0228725470cb340.png](../_resources/e411470313c44dfd96bab38671792fca.png)

 
Since the 8 thrusters of the ROV produce a maximum thrust of 40N at operating voltage of 16V, the thrust coefficients are approximated to 40. Thus the thrust coefficient matrix ğ¾ is taken as:


![1ec509f8030c6805152671b9a79bf51c.png](../_resources/96169c62711642e599f8b1084cd97a6f.png)

 
After obtaining the torque vector, the kinetics is used to determine the acceleration in the body frame for the given forces using the state equation:


![3fdcb4d9dd9822a4913feb301e1142bd.png](../_resources/7c3e552fe8ef49cdadcb581996cdb9f0.png)


The kinematics block is then used to define the vehicle velocity in the world frame ğ‘£n. The position of the vehicle is then determined in the integrator and, using inverse kinematics, is converted to the body frame before being supplied back into the controller.

B. **Non-Linear Model:**
Because of disturbances underwater like current speed, there will be non-linearities introduced into the system. This makes the linear-PID controller model inappropriate to use as there will be a lot of deviations from the desired o/p and noise in the system. So, we need to include the system dynamics to get the control input to the thrusters. 
In the nonlinear model-based PID control system design, the dynamic model of the ROV is utilized to produce a 6-DoF predictive force and the model-based PID is used to provide a corrective force in 6 DoFs to adjust the error in the model. This is advantageous in that the model error and nonlinearities tend to be smaller than the dynamics themselves.
In the predictive force generation, a virtual reference trajectory strategy is introduced for the design of trajectory tracking. With the use of a scalar measure of tracking in Fossen (Fossen, 1994), a virtual reference ğ‘¥ğ‘Ÿ can be defined that satisfies:
ğ‘¥ğ‘Ÿ_dot = ğ‘¥ğ‘‘Ì‡ _dot+ ğœ†ğ‘’ğ‘

where ğœ† > 0 is the control bandwidth that describes the amount of tracking error to the overall tracking performance, and ğ‘’ğ‘
is the tracking error in the body frame. 
Since the velocity ğ‘£ is the time derivative of the position (i.e. ğ‘£ = ğœ‚Ì‡), for a defined virtual reference position ğœ‚ğ‘Ÿ, the following is satisfied:
ğ‘£ğ‘Ÿ = ğ‘£ğ‘‘ + ğœ†ğ‘’b

So, lambda(ğœ†) is used to tune the 6-DoF predictive force.
This is shown in the following block:


![e8fe240722b97ff01cc6a4190694cc3f.png](../_resources/d811d9409d9843aa9b5c60d1107003b0.png)


Where â€˜Aâ€™ is the new controller output.


The PID controller gains(Kp, Ki and Kd) for the non-linear model are found out by Ziegler Nichols method and were found out to be as follows:


![fe6dbb5745ef6800216b5a3d32d63187.png](../_resources/129f58e9c2f24d07949ee84f266e825c.png)


Finally, the control law for the nonlinear model-based PID controller is computed given by:


![3589babf62fbea27ed46fc2d89aa35d7.png](../_resources/3266f33f3292482abd0f116229289515.png)


The final model for this system is shown below:


![f19c09e97f93f0911ae4bf17dbeb2576.png](../_resources/f3fc12aa6d8a4a3d95ed3389f4b3b541.png)


Here, we took desired position input as [1; 1; 2; 0; 0; 0].

## **Implementation:**
We implemented the models for both the controllers above and got the following results when we give a desired positional input:
1) **Linear Controller Model:**
Using the above method, we have obtained the following results for a desired position input: eta_d = [3;4;1;1.57;0;0].
The output of the position and orientation control is obtained as follows:

**Position X :**
Desired output: 3m
Obtained result:


![6dd2f63f9cb923bf64a25d0ea9ad417d.png](../_resources/af61e98355d24e28a72f77ecc0595853.png)


The steady state response final value = 3.



**Position Y :**
Desired output: 4m
Obtained result:


![ee0631cd3fa4a2153e3432fd9fc065bc.png](../_resources/a1f09339cf7e4e95b06c1994106d7893.png)


The steady state response final value = 4.



**Position Z :**
Desired output: 1m
Obtained result:


![b35b66d57776b02dbb3463af11d7f7b0.png](../_resources/2537b8495a8349f58dd99b527b3fc3c2.png)


The steady state response final value = 1.



**Orientation ğ›· :**
Desired output: 1.57 radians
Obtained result:


![fd6ac83dd3f5712d12140a36d56e7b40.png](../_resources/285a62905f924269bd61c1a3fcf674c6.png)


The steady state response final value = 1.57.



**Orientation ğ›³ :**
Desired output: 0 radians
Obtained result:


![b8e1975a6390c95d21f8a157c8c9eee4.png](../_resources/2232b99d96a04baebe03d95dff546051.png)


The steady state response final value = 0.



**Orientation ğ›¹ :**
Desired output: 0 radians
Obtained result:


![b8ef6857c1dff9c3a00c338d87099cf7.png](../_resources/fd564d5164c7439b9ce10bf865aee67c.png)


The steady state response final value = 3.



 The control inputs to the thrusters for the same are represented in the plots below:


![ca854252df064c4c92a93e74eccf4700.png](../_resources/6194bc22daaf4c75be736403862b03f1.png)



 As it is evident from the plots, each thruster is instructed to provide the required thrust every instant for a finite period of time after which the control input eventually settles down to a final value.
 
The model of the rover under study somewhat looks like this:


![ce70afa386d5206382d8b4e3d6b4922c.png](../_resources/bd6740c3627e4057a837adf471880e8c.png)



Here, the thrusters 1,2,3,4 are used in the position control in the X,Y directions while 5,6,7,8 are used for the Z-directional control. If we see the plots for the thruster control inputs for 1,2,3,4:


![3fc81ad4c98b59f9151b5da2a47250bb.png](../_resources/c66d1d5df3ab4d7aa172690a8a71ca9f.png)



We can observe the steady state final value to be zero for all the thrusters 1,2,3,4. 

**Reason:** The above thrusters are used for controlling the position in X,Y directions and their respective control inputs drive them to work in a synchronized manner so as to reach the respective position. Once the rover has reached the required X,Y, coordinates of the position with the required orientation, there is no need for them to provide any more thrust given the lack of any external force acting in the X,Y directions.

The interesting part comes when we observe the control input plots for the thrusters 5,6,7,8:


![049900d09da565b9cc9ea01fd09bf72c.png](../_resources/8d03e9be9f7244989d72f4e29d01994f.png)



As it is observed, each of the control inputs have a non-zero steady state value; positive for thrusters 6,7 and negative for thrusters 5,8. 

**Reason:** Thrusters 5,6,7,8 are used for positional control in the Z direction. When the rover moves to the desired Z coordinate position in the required orientation, the job of the thrusters is not done since the position has to be retained while neutralizing an external force. This external force is the buoyancy acting upon the rover since it is designed to be positively buoyant. The values of forcing acting due to weight and buoyancy for the rover under study are:

W = 112.8 N
B = 114.8 N ; 
this implies that the net external force acting on the rover is 2N upwards.
When we look at thrusters 5,8 ; they provide a thrust vertically upwards when rotated clockwise while thrusters 6,7 produce a thrust vertically downwards for the same. This means that for thrusters 5,8 positive thrust is upwards while negative thrust is downwards. This is opposite in the case of thrusters 6,7 From the plots of control inputs to the above thrusters, the steady state values are as follows:
For thrusters 5,8: -1.25*10-2 (approx.)
For thrusters 6,7: +1.25*10-2 (approx.)
Thrust produced by thrusters 5,8 is negative, which implies that thrust is produced in the  vertically downwards direction.
Thrust produced by thrusters 6,7 is positive, which again implies that thrust is produced in the vertically downwards direction.
Total thrust produced T = K*u where K= 40 for all the thrusters.
Total thrust produced in steady state: 4*1.25*10-2 *40 N = 2 N downwards. 
Since the external force in Z direction has been neutralized, the rover is stabilized once it reaches the desired position.

This is how the positional control of the underwater rover has been established using the linear PID control method.

2) **Non-Linear Controller Model:**
For desired positional input as [1; 1; 2; 0; 0; 0], we got the following results for positional coordinates in world frame:
**Position X :**
Desired output: 1 m


![6c4497a819a14611b434408d2b840cea.png](../_resources/eb8411ac6bf84469932bf6e0953a223e.png)



**Position Y :**
Desired output: 1 m


![f0d6456818c32efc7a8396b70cf65a5b.png](../_resources/c57042350e174e569fbb0a2fbde7be89.png)



**Position Z :**
Desired output: 2 m


![2b7a2cb84c02c6fd815a8337972f5c42.png](../_resources/e68ffc2359ac45ceb0f861486b3ddbe5.png)



**Orientation ğ›· :**
Desired output: 0 rad


![2fbc87c6757c50cf0ad43df0d079c012.png](../_resources/5ddad0dc188045598508698457d50be5.png)



**Orientation ğ›³ :**
Desired output: 0 rad


![a4a80de355e7d85284f09286e812d113.png](../_resources/dc39b68c1cf747968f2ab5954fccce0e.png)



**Orientation ğ›¹ :**
Desired output: 0 rad


![d23f8327ad6daf6c43da413ee9008f73.png](../_resources/deff84a9affd4c869b854651efb92ef5.png)



The controller input plots (controller input for each thruster will be as follows):


![80835ab6d570de6cd5bb53d4d59e758a.png](../_resources/156d740230b54c1fa19999bc70578f28.png)



So, we can see that the thrust control input for thrusters 5,6,7 and 8 will be: -1.375e-02, 1.375e-02, 1.375e-02, -1.375e-02 respectively.
Now, since propeller pair of 5 and 8 will be opposite to that of the pair 6 and 7, we get the total thrust on the ROV in Z-direction as:
1.375e-02*4*40 = 2N (approx.), where 40 is the gain. 
So, the force in the vertical direction is balanced.

The Non-linear model above is made as an extension to the linear model and its Simulink model is available in my Github Repository. 

For the above work, we referred to the following article:
- https://flex.flinders.edu.au/file/27aa0064-9de2-441c-8a17-655405d5fc2e/1/ThesisWu2018.pdf

We next plan at implementing our model with LQR controller. 

---

